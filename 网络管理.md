# ifconfig 查看网络配置

> **主要用于查看网卡的配置信息，也可以用于临时修改网卡配置信息，但是服务器重启或者网卡重启之后就会恢复设置 **

## 修改默认的网卡名称

```shell
vim /etc/default/grub
# grub_cmdline_linux配置项中的net.ifnames=0 biosdevname=0
# grub2-mkconfig -o /boot/grub2/grub.cfg
reboot
```

## TLDR

```shell
  ifconfig

  Network Interface Configurator.
  More information: https://net-tools.sourceforge.io/man/ifconfig.8.html.

  - View network settings of an Ethernet adapter:
    ifconfig eth0

  - Display details of all interfaces, including disabled interfaces:
    ifconfig -a

  - Disable eth0 interface:
    ifconfig eth0 down

  - Enable eth0 interface:
    ifconfig eth0 up

  - Assign IP address to eth0 interface:
    ifconfig eth0 ip_address
```

# route 静态路由表配置

>**通过这个命令添加的路由表是一次性的，如果需要永久有效，需要在/etc/rc.local中修改**

## 查看静态路由表

```shell
# 不带域名解析
route -n
# 带域名解析
route
```

## 删除默认网关

```shell
route del default gw 10.0.8.1
```

## 添加默认网关

```shell
route add default gw 10.0.8.1
```

## 添加明细路由

```shell
# 为指定主机添加路由节点
route add -host 192.168.1.2 gw 192.168.1.1
# 为指定子网添加路由节点
route add -net 192.168.1.0 gw 192.168.1.1 netmask 255.255.255.0
```

## TLDR

```shell
  route

  Use route cmd to set the route table.
  More information: https://manned.org/route.

  - Display the information of route table:
    route -n

  - Add route rule:
    sudo route add -net ip_address netmask netmask_address gw gw_address

  - Delete route rule:
    sudo route del -net ip_address netmask netmask_address dev gw_address
```




# ping 测试连通性

## 测试连通性

```shell
# 指定发送包的数量
ping -c 4 www.baidu.com
# 指定每个包之间的间隔时间
ping -i 2 www.baidu.com
```

## TLDR

```shell
  ping

  Send ICMP ECHO_REQUEST packets to network hosts.
  More information: https://manned.org/ping.

  - Ping host:
    ping host

  - Ping a host only a specific number of times:
    ping -c count host

  - Ping host, specifying the interval in seconds between requests (default is 1 second):
    ping -i seconds host

  - Ping host without trying to lookup symbolic names for addresses:
    ping -n host

  - Ping host and ring the bell when a packet is received (if your terminal supports it):
    ping -a host

  - Also display a message if no response was received:
    ping -O host
```

# traceroute 路由节点跟踪

## 主要使用形式

```shell
traceroute -m 10 www.baidu.com            # 跳数设置 
traceroute -n www.baidu.com               # 显示IP地址，不查主机名 
traceroute -p 6888 www.baidu.com          # 探测包使用的基本UDP端口设置6888 
traceroute -q 4 www.baidu.com             # 把探测包的个数设置为值4 
traceroute -r www.baidu.com               # 绕过正常的路由表，直接发送到网络相连的主机 
traceroute -w 3 www.baidu.com             # 把对外发探测包的等待响应时间设置为3秒
```

## TLDR

```shell
  traceroute

  Print the route packets trace to network host.
  More information: https://manned.org/traceroute.

  - Traceroute to a host:
    traceroute host

  - Disable IP address and host name mapping:
    traceroute -n host

  - Specify wait time for response:
    traceroute -w 0.5 host

  - Specify number of queries per hop:
    traceroute -q 5 host

  - Specify size in bytes of probing packet:
    traceroute host 42
```

# mtr ping和traceroute的结合

## TLDR

```shell
  mtr

  Matt's Traceroute: combined traceroute and ping tool.
  More information: https://bitwizard.nl/mtr.

  - Traceroute to a host and continuously ping all intermediary hops:
    mtr host

  - Disable IP address and host name mapping:
    mtr -n host

  - Generate output after pinging each hop 10 times:
    mtr -w host

  - Force IP IPv4 or IPV6:
    mtr -4 host

  - Wait for a given time (in seconds) before sending another packet to the same hop:
    mtr -i seconds host

```

# nslookup 域名查询

## 域名服务器配置文件

```shell
#/etc/resolv.conf
```

## 查询指定域名的IP地址

```shell
nslookup www.baidu.com
```

## TLDR

```shell
  nslookup

  Query name server(s) for various domain records.
  More information: https://manned.org/nslookup.

  - Query your system's default name server for an IP address (A record) of the domain:
    nslookup example.com

  - Query a given name server for a NS record of the domain:
    nslookup -type=NS example.com 8.8.8.8

  - Query for a reverse lookup (PTR record) of an IP address:
    nslookup -type=PTR 54.240.162.118

  - Query for ANY available records using TCP protocol:
    nslookup -vc -type=ANY example.com 

  - Query a given name server for the whole zone file (zone transfer) of the domain using TCP protocol:
    nslookup -vc -type=AXFR example.com name_server

  - Query for a mail server (MX record) of the domain, showing details of the transaction:
    nslookup -type=MX -debug example.com

  - Query a given name server on a specific port number for a TXT record of the domain:
    nslookup -port=port_number -type=TXT example.com name_server

```

# telnet 登录远程主机

## telnet的相关配置

```
man xinetd.conf
```

## 启动telnet服务

```
service xinetd restart
```

## 常用配置参数

```
service telnet
{
	disable = no #启用
	flags = REUSE#socket #可重用
	socket_type = stream #链接方式为TCP
	wait = no #为每个请求单独启动一个进程
	user = root #启动服务的用户为root
	server = /usr/sbin/in.telnetd #要激活的进程
	log_on_failure += USERID #记录登录失败的用户名
}
```

## 配置允许登录的用户IP

```
only_from = 192.168.1.2 #只允许192.168.1.1进行telnet登录
```

## 配置禁止登录的用户IP

```
no_access = 192.168.1.{3, 4, 5} #禁止192.168.1.3-5登录
```

## 配置可以登录的时间段

```
access_time = 9:00-12:00 13:00-17:00 #每天只有这两个时间段可以登录
```

## 绑定指定的IP地址登录

```
bind = 192.168.1.2
```

## 配置端口

```
vim /etc/services
telnet 23/tcp
telnet 23/udp
```

## TLDR

```shell
  telnet

  Connect to a specified port of a host using the telnet protocol.
  More information: https://manned.org/telnet.

  - Telnet to the default port of a host:
    telnet host

  - Telnet to a specific port of a host:
    telnet ip_address port

  - Exit a telnet session:
    quit

  - Emit the default escape character combination for terminating the session:
    Ctrl + ]

  - Start telnet with "x" as the session termination character:
    telnet -e x ip_address port

  - Telnet to Star Wars animation:
    telnet towel.blinkenlights.nl
```

# tcpdump 抓包指令

## 监听所有流经第一个网卡的数据包

```shell
#如果不指定监听的网络接口，则默认监听第一个网络接口，一般是eth0
tcpdump
```

## 监听指定网络接口的数据包

```shell
tcpdump -i eth1
```

## 监听指定主机的数据包

```shell
#打印所有进入或离开hostname的数据包
tcpdump host hostname
#也可以指定IP进行监听
tcpdump host 192.168.1.2
#监听helios与hot或者与ace之间的通信数据包
tcpdump host helios and \( hot or ace \)
#监听192.168.1.1与192.168.1.2或与192.168.1.3之间的通信数据包
tcpdump host 192.168.1.1 and \( 192.168.1.2 or 192.168.1.3 \)
#监听192.168.1.1与除192.168.1.2外的其他主机的通信数据包
tcpdump host 192.168.1.1 and ! 192.168.1.2
#监听eth0上所有来自主机hostname的数据包
tcpdump -i eth0 src host hostname
#监听eth0上所有去往主机hostname的数据包
tcpdump -i eth0 dst host hostname
```

## 监听指定主机和端口的数据包

```shell
#监听主机210.27.48.1接受或发出的telnet数据包（一般是tcp协议，端口23）
tcpdump host 210.27.48.1 and tcp port 23
#监听本机UDP协议的123端口
tcpdump udp port 123
```

## 监听指定网络的数据包

```shell
#监听本地主机与ucb-ether网络上的主机之间的数据包
tcpdump net ucb-ether
#监听所有通过网关snup的ftp数据包
tcpdump 'gateway snup and ( port ftp or ftp-date )'
#监听所有源地址或目标地址是本地主机的IP数据包
tcpdump ip and not net localnet
#监听80端口的HTTP报文
tcpdump -i any port 80 -A
```

## TLDR

```shell
  tcpdump

  Dump traffic on a network.
  More information: https://www.tcpdump.org.

  - List available network interfaces:
    tcpdump -D

  - Capture the traffic of a specific interface:
    tcpdump -i eth0

  - Capture all TCP traffic showing contents (ASCII) in console:
    tcpdump -A tcp

  - Capture the traffic from or to a host:
    tcpdump host www.example.com

  - Capture the traffic from a specific interface, source, destination and destination port:
    tcpdump -i eth0 src 192.168.1.1 and dst 192.168.1.2 and dst port 80

  - Capture the traffic of a network:
    tcpdump net 192.168.1.0/24

  - Capture all traffic except traffic over port 22 and save to a dump file:
    tcpdump -w dumpfile.pcap port not 22

  - Read from a given dump file:
    tcpdump -r dumpfile.pcap
```

# netstat 查看网络状态

## 列出所有端口

```shell
netstat -a  #列出所有端口
netstat -at #列出所有tcp端口
netstat -au #列出所有udp端口
```

## 列出所有处于监听状态的端口

```shell
netstat -l  #只显示监听状态的端口
netstat -lt #只显示所有监听状态的tcp端口
netstat -lu #只显示所有监听状态的udp端口
netstat -lx #只显示所有监听状态的unix端口
```

## 显示每个协议的统计信息

```shell
netstat -s  #显示所有端口的统计信息
netstat -st #显示tcp端口的统计信息
netstat -su #显示udp端口的统计信息
netstat -pt #显示tcp端口的进程信息
```

## 取消域名解析

```shell
netstat -n
```

## 持续显示netstat信息

```shell
netstat -c
```

## 显示核心路由信息

```shell
netstat -r #作用同route
```

## 显示网络接口列表

```shell
netstat -i
netstat -ie #作用同ifconfig
```

## 显示指定程序的运行端口

```shell
netstat -ap | grep ssh
```

## 显示指定端口所运行的程序进程

  ```shell
  netstat -ap | grep ':23'
  ```

## 通过指定端口找到运行的程序ID

  ```shell
  netstat -anp | grep 8081 | grep LISTEN | awk '{printf $7}' | cut -d/ -f1
  ```

## 查看连接某服务端口最多的IP地址

  ```shell
  netstat -ntu | grep :80 | awk '{print $5}' | cut -d: -f1 | 
  awk '{++ip[$1]} END {for(i in ip) print ip[i], "\t", i}' | sort -nr
  ```

## tcp各种状态列表

  ```shell
  netstat -nt | grep -e 127.0.0.1 -e 0.0.0.0 -e ::: -v |
  awk '/^tcp/ {++state[$NF]} END {for(i in state) print i, "\t", state[i]}'
  ```

## 查看stdout进程数

  ```shell
  netstat -anpo | grep 'stdout' | wc -l
  ```

## TLDR

  ```shell
    netstat
  
    Displays network-related information such as open connections, open socket ports, etc.
    More information: https://man7.org/linux/man-pages/man8/netstat.8.html.
  
    - List all ports:
      netstat --all
  
    - List all listening ports:
      netstat --listening
  
    - List listening TCP ports:
      netstat --tcp
  
    - Display PID and program names:
      netstat --program
  
    - List information continuously:
      netstat --continuous
  
    - List routes and do not resolve IP addresses to hostnames:
      netstat --route --numeric
  
    - List listening TCP and UDP ports (+ user and process if you're root):
      netstat --listening --program --numeric --tcp --udp --extend
  ```




# 网络配置文件

## 主机名称配置文件

  ```shell
  #修改主机名称
  hostnamectl set-hostname centos7.test
  #需要在/etc/hosts中添加映射
  127.0.0.1 Robotinx Robotinx
  ```

## 网卡配置文件

  ```shell
  /etc/sysconfig/network-scipts/ifcfg-eth0
  
  1. TYPE=Ethernet  
  #  网络类型 Ethernet 以太网
   
  2. PROXY_METHOD=none    
  #  代理方式
   
  3. BROWSER_ONLY=no 
  #  只是浏览器：否
   
  4. BOOTPROTO=none 
  #  网卡协议 获取网卡IP的方式
  #  dhcp：    动态主机配置协议
  #  static：  手动配置固定IP
  #  none：    手动配置固定IP
   
  5. DEFROUTE=yes
  #  默认路由：是  
  #  如果IP数据包中的目的地址找不到存在的其他路由时，
  #  路由器会默认的选择路由
   
  6. IPV4_FAILURE_FATAL=no 
  #  是否开启IPV4致命错误检测：否
   
  7. PV6INIT=yes 
  #  IPV6初始化: 是
   
  8. IPV6_AUTOCONF=yes
  #  IPV6是否自动配置：是
   
  9. IPV6_DEFROUTE=yes
  #  IPV6 默认路由：是  
   
  10. IPV6_FAILURE_FATAL=no 
  #  是否开启IPV6致命错误检测：否
   
  11. IPV6_ADDR_GEN_MODE=stable-privacy 
  #  IPV6地址生成模型  stable-privacy:一种生成IPV6的策略
   
  12. NAME=ens33 
  #  网卡名称
   
  13. UUID=ce12bd82-d2c1-4425-8e16-ff976f178200
  #  唯一标识码
   
  14. DEVICE=ens33
  #  网卡设备名称
   
  15. ONBOOT=yes 
  #  在开机或重启时是否启动网卡
   
  16. IPADDR=192.168.2.121
  #  手动配置静态ip地址
   
  17. NETMASK=255.255.255.0
  #  子网掩码
   
  18. GATEWAY=192.168.2.1
  #  默认网关
   
  19. DNS1=8.8.8.8
  #  dns域名解析服务器
   
  重启网卡服务命令
  service network restart
  ```

## DNS服务器配置文件

  ```shell
  /etc/resolv.conf
  ```

## service自动控制服务名

  ```
  /etc/init.d
  ```

## telnet配置文件

```shell
/etc/xinetd.conf
```



# 常用的网络端口

| 端口       | 协议 |
| ---------- | ---- |
| HTTP       | 80   |
| HTTPS      | 443  |
| FTP        | 21   |
| TELNET.TCP | 23   |
| TFTP       | 69   |
| SMTP       | 25   |
| DNS        | 53   |
